{"version":3,"sources":["C:\\bin\\Dropbox\\workspace\\tonyu2-compiler\\test\\fixture\\ast\\Main.tonyu"],"names":[],"mappings":"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","sourcesContent":["native Tonyu;\r\nnative console;\r\nnative JSON;\r\nnative Set;\r\nnative Symbol;\r\nnative Map;\r\n\"field strict\";\r\n\r\nlet idseq=1;\r\nlet types={};\r\nlet map=new Map();\r\nlet res={};\r\nproc();\r\n\\proc() {\r\n    let cl=Tonyu.classMetas[\"user.Main\"];\r\n    //console.log(JSON.stringify(cl.node));\r\n    //let SYM_VISITED=Symbol(\"_aid\");\r\n    //JSON.stringify(cl.annotation, traverse) \r\n    let root=traverse({node:cl.node, annotation:cl.annotation},{path:[\"root\"]});\r\n    if (root.REF!==1) {\r\n        throw new Error(root.REF);\r\n    }\r\n    console.log(types);\r\n    /*for (let k of Object.keys(types).sort()) {\r\n        console.log(k, types[k].length);\r\n    }*/\r\n    console.log(JSON.stringify(res));\r\n    //console.log(types.node);\r\n    console.log(JSON.stringify(res[\"1\"]));\r\n}\r\n\r\n\\refobj(id) {\r\n    return {REF:id};\r\n}\r\n\\builtin(name) {\r\n    return {BUILTIN:name};\r\n}\r\n\\packAnnotations(ans) {\r\n    let res={};\r\n    for (let k of Object.keys(ans)) {\r\n        if (isEmptyAnnotation(ans[k])) continue;\r\n        res[k]=ans[k];\r\n    }\r\n    return res;\r\n}\r\n\\isEmptyAnnotation(a) {\r\n    return a && typeof a===\"object\" && Object.keys(a).length===1 && Object.keys(a)[0]===\"node\";\r\n}\r\n\\isArray(a) {\r\n    return a && typeof a.slice===\"function\" && \r\n    typeof a.map===\"function\" && typeof a.length===\"number\" ;\r\n}\r\n\\pushPath(ctx, k) {\r\n    let nc={path: ctx.path.slice()};\r\n    if (looksLikeNum(k)) k=\"[]\";\r\n    nc.path.push(k);\r\n    return nc;\r\n}\r\n\\isNativeSI(a) {\r\n    return a.type===\"native\" && a.value;\r\n}\r\nfunction isSFile(path) {\r\n    return path && typeof (path.isSFile)==\"function\" && path.isSFile();\r\n}\r\n\\traverse(a,ctx) {\r\n    if (a && typeof a===\"object\") {\r\n        if (map.has(a)) {\r\n            return refobj(map.get(a));\r\n        }\r\n        let id=idseq++;\r\n        map.set(a, id);\r\n        let res;\r\n        if (isSFile(a)) {\r\n            res={isSFile:true, path:a.path()};\r\n        } else if (isArray(a)) {\r\n            res=a.map\\(e){\r\n                return traverse(e,pushPath(ctx,\"[]\"));\r\n            };\r\n        } else {\r\n            keys(a, ctx);\r\n            res={};\r\n            let nsi=isNativeSI(a);\r\n            for (let k of Object.keys(a)) {\r\n                if (nsi && k===\"value\") continue;\r\n                if (k===\"toString\") continue;\r\n                let nc=pushPath(ctx,k);\r\n                res[k]=traverse(a[k], nc);\r\n            }\r\n        }\r\n        this.res[id]=res;\r\n        return refobj(id);\r\n    } else if (typeof a===\"function\") {\r\n        return \"<function>\";\r\n    } else {\r\n        return a;\r\n    }\r\n}\r\n\\keys(obj,ctx) {\r\n    let k=Object.keys(obj).sort().join(\",\");\r\n    types[k]=types[k]||{first:ctx.path.join(\".\")};\r\n    let pathTail=ctx.path[ctx.path.length-1];\r\n    if (pathTail===\"[]\") {\r\n        pathTail=ctx.path[ctx.path.length-2]+pathTail;\r\n    }\r\n    types[k][pathTail]=types[k][pathTail]||0;\r\n    types[k][pathTail]++;\r\n}\r\n\\looksLikeNum(k) {\r\n    return k.match(/^\\d+$/);\r\n}\r\n\\mul(s, n) {\r\n    let r=\"\";\r\n    while(--n>0) r+=s;\r\n    return r;\r\n}"]}