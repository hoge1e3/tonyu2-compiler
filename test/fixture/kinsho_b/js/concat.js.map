{"version":3,"sources":["C:\\bin\\Dropbox\\workspace\\tonyu2-compiler\\test\\fixture\\kinsho_b\\Board.tonyu","C:\\bin\\Dropbox\\workspace\\tonyu2-compiler\\test\\fixture\\kinsho_b\\Main.tonyu"],"names":[],"mappings":"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","sourcesContent":["extends State;\r\n\r\nlet mat:Matrix; // 0 あき  1 P1の金　2 P2の金  3 P1の王　4 P2の玉\r\nlet player:Number;\r\n\\next(ctx:Context, a):State {\r\n    //a:Action|Event\r\n    let nm=mat.clone();\r\n    let p=mat.get(a.x,a.y);\r\n    nm.set(a.x,a.y,0);\r\n    nm.set(a.x+a.dx, a.y+a.dy, p);\r\n    let foe=3-player;\r\n    return new Board{mat:nm, player:foe};\r\n}\r\n\r\n\\actionsEvents(ctx:Context) {\r\n    //: Action[] | Event[] \r\n    // Action:プレイヤーがとる行動\r\n    // Event :ランダムに起きる事象（サイコロなど）\r\n    // Eventオブジェクトにはフィールドprob(確率を表す0..1の数値)を含め，\r\n    // Event配列のprobの合計値が1になるようにしてください\r\n    // ActionとEventを混ぜて返すことはできません．\r\n    // 常に同じ順序で同じものを返してください\r\n    let res=[];\r\n    let kings=0;\r\n    for (let x,y,p of mat) {\r\n        if (p===player || p===player+2) {\r\n            let dy=(p==1||p==3)?-1:1;\r\n            for (let dx=-1;dx<=1;dx++) {\r\n                let g=mat.get(x+dx,y+dy);\r\n                let gt=(g>=3 ? g-2: g);\r\n                let pt=(p>=3 ? p-2: p);\r\n                //print(p, x+dx,y+dy, g, g!=null, g!=p , g!=p+2);\r\n                if (g!=null && gt!=pt) {\r\n                    //print(\"Push!\");\r\n                    res.push{x,y,dx,dy};\r\n                }\r\n            }\r\n        }\r\n        if (p==3||p==4) kings++; \r\n    }\r\n    if (kings<2) return [];\r\n    return res;\r\n}\r\n\\gameover(ctx:Context) {\r\n    return actionsEvents(ctx).length==0;\r\n    //throw new Error(\"Abstract: メソッドgameoverが実装されていません\");    \r\n}\r\n\\toString() {\r\n    let buf=\"\",py=0;\r\n    for (let x,y,p of mat) {\r\n        if (y!=py) buf+=\"\\n\";\r\n        py=y;\r\n        buf+=p+\" \";\r\n    }\r\n    buf+=\"\\n\"+\"Player \"+player;\r\n    return buf;\r\n}\r\n","\"field strict\";\r\nnative process;\r\n//$Screen.resize(200,600);\r\n\r\n\r\n//                                           4    5   6  7     8    9  10    11             12\r\n// node index.js test\\fixture\\kinsho_b\\   -r mcts 100 2  mcts 1000 2  1234  replayFile.txt 10\r\nif(!process.argv[10]){\r\n    throw new Error(\"ゲーム実行回数が入力されていません！\");\r\n}\r\nvar player1 = {name:process.argv[4],iteration:process.argv[5],timeout:process.argv[6]};\r\nvar player2 = {name:process.argv[7],iteration:process.argv[8],timeout:process.argv[9]};\r\nprint(player1);\r\nprint(player2);\r\n\\botParameter(player){\r\n    var bot;\r\n    if(player.name == \"mcts\"){\r\n        bot = new MCTSBot{value,Cp:10, expandThresh:3, iteration:Number(player.iteration), timeout:Number(player.timeout)};\r\n    }else if(player.name == \"cmcts\"){\r\n        //bot = new CornerMCTSBot{value,Cp:10, expandThresh:3, iteration:Number(player.iteration), timeout:Number(player.timeout)};\r\n    }else{\r\n        throw new Error(\"bot:\",bot);\r\n    }\r\n    return bot;\r\n}\r\nlet bots=[0, botParameter(player1), botParameter(player2)];\r\n\r\n\\value(ctx:Context, player: Number, state:Board) {\r\n    let acts=state.actionsEvents(ctx);\r\n    if (acts.length===0) {\r\n        if (player===state.player) return 0;\r\n        else return 1;\r\n    }\r\n    if (player===state.player) {\r\n        return 0.5+acts.length/komas/3;\r\n    } else {\r\n        return 0.5-acts.length/komas/3;\r\n    }\r\n    /*let foe=3-player;\r\n    let sc=0.5;\r\n    for (let x,y,p of state.mat) {\r\n        if (p==player+2 || p==player) sc+=1/komas;\r\n        if (p==foe+2 || p==foe ) sc-=1/komas;\r\n    }\r\n    if (sc!==sc) throw new Error(\"sc nan!\");\r\n    return sc;*/\r\n}\r\n\r\nlet komas;\r\nlet replayFile=process.argv[11];\r\nif(replayFile){//リプレイtrueの時\r\n    update();\r\n    let context=new Context{players:[1,2], bots};\r\n    let state=initBoard();\r\n    let replay = new Replay{state, context, logFile: replayFile };\r\n    let turn=process.argv[12];\r\n    for (let i=0;i<turn;i++) {\r\n        print(replay.state+\"\");\r\n        replay.step();\r\n    }\r\n    print(replay.state+\"\");\r\n    let bot=bots[replay.state.player];\r\n    replay.dump(bot);\r\n} else {\r\n    for (let i=0;i<process.argv[10]-0 ;i++) {\r\n        match();   \r\n    }\r\n}\r\n\\initBoard(context) {\r\n    let mat=new Matrix;\r\n/*let r=5;\r\nfor (let i=0;i<r;i++) {\r\n    for (let j=0;j<r;j++) {\r\n        mat.set(j,i,0);\r\n    }\r\n}*/\r\n    let s=[\r\n    \"2 2 2 2 2 2 2\", \r\n    \"0 2 0 0 0 2 0\", \r\n    \"2 2 2 2 2 2 2\", \r\n    \"0 0 0 0 0 0 0\", \r\n    \"1 1 1 1 1 1 1\", \r\n    \"0 1 0 0 0 1 0\", \r\n    \"1 1 1 1 1 1 1\"]; \r\n    s=[\r\n    \"2 2 4 2 2\", \r\n    \"2 2 2 2 2\", \r\n    \"0 0 0 0 0\", \r\n    \"1 1 1 1 1\", \r\n    \"1 1 3 1 1\"]; \r\n\r\n    let player=1;\r\n/*s=[\r\n\"2 2 4 2 2\", \r\n\"0 1 0 0 2\", \r\n\"2 0 0 1 2\", \r\n\"1 1 0 1 0\", \r\n\"0 0 3 1 1\"];\r\nplayer=2;\r\ns=[\r\n\"2 0 4 2 2\", \r\n\"0 0 0 0 2\", \r\n\"2 0 2 1 0\", \r\n\"1 1 1 2 0\",\r\n\"0 0 3 0 1\"];\r\nplayer=1;\r\n*/\r\n    komas=0;\r\n    for (let r,row of s) {\r\n        for (let c,col of row.split(\" \")) {\r\n            if (col!=\"0\") komas++;\r\n            mat.set(c,r,col-0);\r\n        }\r\n    }\r\n    print(\"komas\", komas);\r\n    let state=new Board{mat,player};\r\n    return state;\r\n}\r\n\\match() {\r\n    //print(\"iters:\" ,it1, it2);\r\n    //print(\"totaltimes:\", tt1, tt2);\r\n    //print(\"timeouts:\", to1, to2);\r\n\r\n    let context=new Context{players:[1,2], bots};\r\n    let state=initBoard();\r\n    let logger=new Logger;\r\n    let g=new GameMaster{context, state, logger};\r\n    print(g.state+\"\");\r\n    while (!g.gameover()) {\r\n        let a=g.step();\r\n        print(a.x, a.y, a.dx, a.dy);\r\n        print(g.state+\"\");\r\n        print(value(context, g.state.player, g.state ));\r\n        updateEx(1);\r\n    }\r\n    logger.add(\"Result: loser=\"+g.state.player);\r\n    //print(it1, it2);\r\n    //print(\"loser is \",g.state.player);\r\n    \r\n    \r\n}\r\n"]}